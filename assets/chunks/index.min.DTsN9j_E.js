var Tt=Object.defineProperty;var kt=($,X,q)=>X in $?Tt($,X,{enumerable:!0,configurable:!0,writable:!0,value:q}):$[X]=q;var r=($,X,q)=>kt($,typeof X!="symbol"?X+"":X,q);import{g as yt}from"./theme.CXdDS2G6.js";function St($,X){for(var q=0;q<X.length;q++){const Q=X[q];if(typeof Q!="string"&&!Array.isArray(Q)){for(const B in Q)if(B!=="default"&&!(B in $)){const se=Object.getOwnPropertyDescriptor(Q,B);se&&Object.defineProperty($,B,se.get?se:{enumerable:!0,get:()=>Q[B]})}}}return Object.freeze(Object.defineProperty($,Symbol.toStringTag,{value:"Module"}))}var Ee={exports:{}};(function($,X){(function(q,Q){$.exports=Q()})(self,function(){return(()=>{var q={180:w=>{w.exports=function(_){var m=[];return m.toString=function(){return this.map(function(T){var I="",p=T[5]!==void 0;return T[4]&&(I+="@supports (".concat(T[4],") {")),T[2]&&(I+="@media ".concat(T[2]," {")),p&&(I+="@layer".concat(T[5].length>0?" ".concat(T[5]):""," {")),I+=_(T),p&&(I+="}"),T[2]&&(I+="}"),T[4]&&(I+="}"),I}).join("")},m.i=function(T,I,p,b,C){typeof T=="string"&&(T=[[null,T,void 0]]);var P={};if(p)for(var H=0;H<this.length;H++){var y=this[H][0];y!=null&&(P[y]=!0)}for(var A=0;A<T.length;A++){var k=[].concat(T[A]);p&&P[k[0]]||(C!==void 0&&(k[5]===void 0||(k[1]="@layer".concat(k[5].length>0?" ".concat(k[5]):""," {").concat(k[1],"}")),k[5]=C),I&&(k[2]&&(k[1]="@media ".concat(k[2]," {").concat(k[1],"}")),k[2]=I),b&&(k[4]?(k[1]="@supports (".concat(k[4],") {").concat(k[1],"}"),k[4]=b):k[4]="".concat(b)),m.push(k))}},m}},548:w=>{w.exports=function(_){return _[1]}},786:w=>{var _,m=typeof Reflect=="object"?Reflect:null,T=m&&typeof m.apply=="function"?m.apply:function(l,d,h){return Function.prototype.apply.call(l,d,h)};_=m&&typeof m.ownKeys=="function"?m.ownKeys:Object.getOwnPropertySymbols?function(l){return Object.getOwnPropertyNames(l).concat(Object.getOwnPropertySymbols(l))}:function(l){return Object.getOwnPropertyNames(l)};var I=Number.isNaN||function(l){return l!=l};function p(){p.init.call(this)}w.exports=p,w.exports.once=function(l,d){return new Promise(function(h,f){function v(S){l.removeListener(d,x),f(S)}function x(){typeof l.removeListener=="function"&&l.removeListener("error",v),h([].slice.call(arguments))}F(l,d,x,{once:!0}),d!=="error"&&function(S,E,R){typeof S.on=="function"&&F(S,"error",E,{once:!0})}(l,v)})},p.EventEmitter=p,p.prototype._events=void 0,p.prototype._eventsCount=0,p.prototype._maxListeners=void 0;var b=10;function C(l){if(typeof l!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof l)}function P(l){return l._maxListeners===void 0?p.defaultMaxListeners:l._maxListeners}function H(l,d,h,f){var v,x,S,E;if(C(h),(x=l._events)===void 0?(x=l._events=Object.create(null),l._eventsCount=0):(x.newListener!==void 0&&(l.emit("newListener",d,h.listener?h.listener:h),x=l._events),S=x[d]),S===void 0)S=x[d]=h,++l._eventsCount;else if(typeof S=="function"?S=x[d]=f?[h,S]:[S,h]:f?S.unshift(h):S.push(h),(v=P(l))>0&&S.length>v&&!S.warned){S.warned=!0;var R=new Error("Possible EventEmitter memory leak detected. "+S.length+" "+String(d)+" listeners added. Use emitter.setMaxListeners() to increase limit");R.name="MaxListenersExceededWarning",R.emitter=l,R.type=d,R.count=S.length,E=R,console&&console.warn&&console.warn(E)}return l}function y(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function A(l,d,h){var f={fired:!1,wrapFn:void 0,target:l,type:d,listener:h},v=y.bind(f);return v.listener=h,f.wrapFn=v,v}function k(l,d,h){var f=l._events;if(f===void 0)return[];var v=f[d];return v===void 0?[]:typeof v=="function"?h?[v.listener||v]:[v]:h?function(x){for(var S=new Array(x.length),E=0;E<S.length;++E)S[E]=x[E].listener||x[E];return S}(v):W(v,v.length)}function D(l){var d=this._events;if(d!==void 0){var h=d[l];if(typeof h=="function")return 1;if(h!==void 0)return h.length}return 0}function W(l,d){for(var h=new Array(d),f=0;f<d;++f)h[f]=l[f];return h}function F(l,d,h,f){if(typeof l.on=="function")f.once?l.once(d,h):l.on(d,h);else{if(typeof l.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof l);l.addEventListener(d,function v(x){f.once&&l.removeEventListener(d,v),h(x)})}}Object.defineProperty(p,"defaultMaxListeners",{enumerable:!0,get:function(){return b},set:function(l){if(typeof l!="number"||l<0||I(l))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+l+".");b=l}}),p.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},p.prototype.setMaxListeners=function(l){if(typeof l!="number"||l<0||I(l))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+l+".");return this._maxListeners=l,this},p.prototype.getMaxListeners=function(){return P(this)},p.prototype.emit=function(l){for(var d=[],h=1;h<arguments.length;h++)d.push(arguments[h]);var f=l==="error",v=this._events;if(v!==void 0)f=f&&v.error===void 0;else if(!f)return!1;if(f){var x;if(d.length>0&&(x=d[0]),x instanceof Error)throw x;var S=new Error("Unhandled error."+(x?" ("+x.message+")":""));throw S.context=x,S}var E=v[l];if(E===void 0)return!1;if(typeof E=="function")T(E,this,d);else{var R=E.length,Y=W(E,R);for(h=0;h<R;++h)T(Y[h],this,d)}return!0},p.prototype.addListener=function(l,d){return H(this,l,d,!1)},p.prototype.on=p.prototype.addListener,p.prototype.prependListener=function(l,d){return H(this,l,d,!0)},p.prototype.once=function(l,d){return C(d),this.on(l,A(this,l,d)),this},p.prototype.prependOnceListener=function(l,d){return C(d),this.prependListener(l,A(this,l,d)),this},p.prototype.removeListener=function(l,d){var h,f,v,x,S;if(C(d),(f=this._events)===void 0)return this;if((h=f[l])===void 0)return this;if(h===d||h.listener===d)--this._eventsCount==0?this._events=Object.create(null):(delete f[l],f.removeListener&&this.emit("removeListener",l,h.listener||d));else if(typeof h!="function"){for(v=-1,x=h.length-1;x>=0;x--)if(h[x]===d||h[x].listener===d){S=h[x].listener,v=x;break}if(v<0)return this;v===0?h.shift():function(E,R){for(;R+1<E.length;R++)E[R]=E[R+1];E.pop()}(h,v),h.length===1&&(f[l]=h[0]),f.removeListener!==void 0&&this.emit("removeListener",l,S||d)}return this},p.prototype.off=p.prototype.removeListener,p.prototype.removeAllListeners=function(l){var d,h,f;if((h=this._events)===void 0)return this;if(h.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):h[l]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete h[l]),this;if(arguments.length===0){var v,x=Object.keys(h);for(f=0;f<x.length;++f)(v=x[f])!=="removeListener"&&this.removeAllListeners(v);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(d=h[l])=="function")this.removeListener(l,d);else if(d!==void 0)for(f=d.length-1;f>=0;f--)this.removeListener(l,d[f]);return this},p.prototype.listeners=function(l){return k(this,l,!0)},p.prototype.rawListeners=function(l){return k(this,l,!1)},p.listenerCount=function(l,d){return typeof l.listenerCount=="function"?l.listenerCount(d):D.call(l,d)},p.prototype.listenerCount=D,p.prototype.eventNames=function(){return this._eventsCount>0?_(this._events):[]}},985:(w,_)=>{for(var m=typeof window<"u"&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform),T={alt:"altKey",control:"ctrlKey",meta:"metaKey",shift:"shiftKey"},I={add:"+",break:"pause",cmd:"meta",command:"meta",ctl:"control",ctrl:"control",del:"delete",down:"arrowdown",esc:"escape",ins:"insert",left:"arrowleft",mod:m?"meta":"control",opt:"alt",option:"alt",return:"enter",right:"arrowright",space:" ",spacebar:" ",up:"arrowup",win:"meta",windows:"meta"},p={backspace:8,tab:9,enter:13,shift:16,control:17,alt:18,pause:19,capslock:20,escape:27," ":32,pageup:33,pagedown:34,end:35,home:36,arrowleft:37,arrowup:38,arrowright:39,arrowdown:40,insert:45,delete:46,meta:91,numlock:144,scrolllock:145,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},b=1;b<20;b++)p["f"+b]=111+b;function C(y,A,k){A&&!("byKey"in A)&&(k=A,A=null),Array.isArray(y)||(y=[y]);var D=y.map(function(F){return function(l,d){var h=d&&d.byKey,f={},v=(l=l.replace("++","+add")).split("+"),x=v.length;for(var S in T)f[T[S]]=!1;var E=!0,R=!1,Y=void 0;try{for(var u,M=v[Symbol.iterator]();!(E=(u=M.next()).done);E=!0){var L=u.value,le=L.endsWith("?")&&L.length>1;le&&(L=L.slice(0,-1));var j=H(L),te=T[j];if(L.length>1&&!te&&!I[L]&&!p[j])throw new TypeError('Unknown modifier: "'+L+'"');x!==1&&te||(h?f.key=j:f.which=P(L)),te&&(f[te]=!le||null)}}catch(ie){R=!0,Y=ie}finally{try{!E&&M.return&&M.return()}finally{if(R)throw Y}}return f}(F,A)}),W=function(F){return D.some(function(l){return function(d,h){for(var f in d){var v=d[f],x=void 0;if(v!=null&&((x=f==="key"&&h.key!=null?h.key.toLowerCase():f==="which"?v===91&&h.which===93?91:h.which:h[f])!=null||v!==!1)&&x!==v)return!1}return!0}(l,F)})};return k==null?W:W(k)}function P(y){return y=H(y),p[y]||y.toUpperCase().charCodeAt(0)}function H(y){return y=y.toLowerCase(),I[y]||y}_.TB=function(y,A){return C(y,{byKey:!0},A)}},108:(w,_,m)=>{m.d(_,{Z:()=>C});var T=m(548),I=m.n(T),p=m(180),b=m.n(p)()(I());b.push([w.id,`.web-editor-pre {
  white-space: pre-wrap;
  word-wrap: break-word;
  margin: 0;
  box-sizing: border-box;
  min-height: 800px;
  line-height: 2;
  font-size: 16px;
  color: #333333;
  font-family: Arial, 'Microsoft YaHei', '微软雅黑', '黑体', Heiti, sans-serif, SimSun, '宋体', serif;
  overflow: scroll;
  width: 50%;
  height: 100%;
  /* height: 600px; */
  outline: 0 none;
  background-color: #fff;
  padding: 10px 20px;
  box-shadow: 0px 0px 8px 3px #ccc;
}
.web-editor-pre::after {
  content: ' ';
}
.web-editor-pre.preview {
  background-color: #fafbfc;
  border-left: 2px solid #ddd;
}
.web-editor-pre a {
  color: #4285f4;
  text-decoration: underline;
}
.web-editor-pre .hide {
  display: none;
}
.web-editor-pre ol,
.web-editor-pre ul,
.web-editor-pre li {
  margin: 0;
  padding: 0;
}
.web-editor-pre ul,
.web-editor-pre ol {
  margin-left: 20px;
}
.web-editor-pre h1::before,
.web-editor-pre h2::before h3::before,
.web-editor-pre h4::before,
.web-editor-pre h5::before,
.web-editor-pre h6::before,
.web-editor-pre p:empty::before {
  content: ' ';
}
.web-editor-pre p {
  margin: 10px 0;
}
.web-editor-pre p::after {
  content: ' ';
}
.web-editor-pre blockquote {
  color: #6a737d;
  border-left: 3px solid #c4c7cc;
  margin: 0 0 18px 0px;
  padding: 0 16px;
}
.web-editor-pre img {
  max-width: 100%;
}
.web-editor-pre .editor-marker {
  color: #660e7a;
  font-weight: bold;
  opacity: 0.5;
}
.web-editor-pre .list-style-none {
  list-style: none;
}
.web-editor-pre input {
  margin: 0 10px 3px 0;
  vertical-align: middle;
}
.web-editor-pre pre {
  white-space: pre-wrap;
  word-wrap: break-word;
  padding: 10px;
  margin: 0;
  box-sizing: border-box;
}
.web-editor-pre pre.code-block {
  background-color: rgba(27, 31, 35, 0.05);
  margin-bottom: 10px;
  border-radius: 3px;
}
.web-editor-pre .code-block-inline {
  background-color: rgba(27, 31, 35, 0.05);
  margin-bottom: 10px;
  border-radius: 3px;
  padding: 3px 10px;
}
.web-editor-pre table {
  border-collapse: collapse;
  empty-cells: show;
  margin-bottom: 16px;
  overflow: auto;
  border-spacing: 0;
  word-break: keep-all;
  width: 100%;
}
.web-editor-pre table tr {
  border: 1px solid #ddd;
  padding: 5px;
}
.web-editor-pre table th,
.web-editor-pre table td {
  border: 1px solid #ddd;
  padding: 10px;
}
`,""]);const C=b},379:w=>{var _=[];function m(p){for(var b=-1,C=0;C<_.length;C++)if(_[C].identifier===p){b=C;break}return b}function T(p,b){for(var C={},P=[],H=0;H<p.length;H++){var y=p[H],A=b.base?y[0]+b.base:y[0],k=C[A]||0,D="".concat(A," ").concat(k);C[A]=k+1;var W=m(D),F={css:y[1],media:y[2],sourceMap:y[3],supports:y[4],layer:y[5]};if(W!==-1)_[W].references++,_[W].updater(F);else{var l=I(F,b);b.byIndex=H,_.splice(H,0,{identifier:D,updater:l,references:1})}P.push(D)}return P}function I(p,b){var C=b.domAPI(b);return C.update(p),function(P){if(P){if(P.css===p.css&&P.media===p.media&&P.sourceMap===p.sourceMap&&P.supports===p.supports&&P.layer===p.layer)return;C.update(p=P)}else C.remove()}}w.exports=function(p,b){var C=T(p=p||[],b=b||{});return function(P){P=P||[];for(var H=0;H<C.length;H++){var y=m(C[H]);_[y].references--}for(var A=T(P,b),k=0;k<C.length;k++){var D=m(C[k]);_[D].references===0&&(_[D].updater(),_.splice(D,1))}C=A}}},569:w=>{var _={};w.exports=function(m,T){var I=function(p){if(_[p]===void 0){var b=document.querySelector(p);if(window.HTMLIFrameElement&&b instanceof window.HTMLIFrameElement)try{b=b.contentDocument.head}catch{b=null}_[p]=b}return _[p]}(m);if(!I)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");I.appendChild(T)}},216:w=>{w.exports=function(_){var m=document.createElement("style");return _.setAttributes(m,_.attributes),_.insert(m,_.options),m}},565:(w,_,m)=>{w.exports=function(T){var I=m.nc;I&&T.setAttribute("nonce",I)}},795:w=>{w.exports=function(_){var m=_.insertStyleElement(_);return{update:function(T){(function(I,p,b){var C="";b.supports&&(C+="@supports (".concat(b.supports,") {")),b.media&&(C+="@media ".concat(b.media," {"));var P=b.layer!==void 0;P&&(C+="@layer".concat(b.layer.length>0?" ".concat(b.layer):""," {")),C+=b.css,P&&(C+="}"),b.media&&(C+="}"),b.supports&&(C+="}");var H=b.sourceMap;H&&typeof btoa<"u"&&(C+=`
/*# sourceMappingURL=data:application/json;base64,`.concat(btoa(unescape(encodeURIComponent(JSON.stringify(H))))," */")),p.styleTagTransform(C,I,p.options)})(m,_,T)},remove:function(){(function(T){if(T.parentNode===null)return!1;T.parentNode.removeChild(T)})(m)}}}},589:w=>{w.exports=function(_,m){if(m.styleSheet)m.styleSheet.cssText=_;else{for(;m.firstChild;)m.removeChild(m.firstChild);m.appendChild(document.createTextNode(_))}}}},Q={};function B(w){var _=Q[w];if(_!==void 0)return _.exports;var m=Q[w]={id:w,exports:{}};return q[w](m,m.exports,B),m.exports}B.n=w=>{var _=w&&w.__esModule?()=>w.default:()=>w;return B.d(_,{a:_}),_},B.d=(w,_)=>{for(var m in _)B.o(_,m)&&!B.o(w,m)&&Object.defineProperty(w,m,{enumerable:!0,get:_[m]})},B.o=(w,_)=>Object.prototype.hasOwnProperty.call(w,_),B.r=w=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(w,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(w,"__esModule",{value:!0})};var se={};return(()=>{B.r(se),B.d(se,{Editor:()=>gt,EditorViewMode:()=>mt,InsertTextOperation:()=>x,Operation:()=>f,RemoveTextOperation:()=>E,SelectionModel:()=>d,SetSelectionOperation:()=>Y,TextModel:()=>h,withCollaborative:()=>bt,withUndoRedo:()=>vt});var w=B(379),_=B.n(w),m=B(795),T=B.n(m),I=B(569),p=B.n(I),b=B(565),C=B.n(b),P=B(216),H=B.n(P),y=B(589),A=B.n(y),k=B(108),D={};D.styleTagTransform=A(),D.setAttributes=C(),D.insert=p().bind(null,"head"),D.domAPI=T(),D.insertStyleElement=H(),_()(k.Z,D),k.Z&&k.Z.locals&&k.Z.locals;var W=B(786),F=B.n(W);function l(s,e=0){let t;return(...n)=>{t&&window.clearTimeout(t),t=window.setTimeout(()=>{s(...n)},e)}}const de=class de extends F(){constructor(t){super();r(this,"textModel_");r(this,"selection_");r(this,"eventTimer_");r(this,"selectionChangeEmit_");this.textModel_=t,this.selection_={anchor:0,focus:0},this.selectionChangeEmit_=l(()=>{this.emit(de.EVENT_TYPE.SELECTION_CHANGE)},100)}static isEqual(t,n){return t.anchor===n.anchor&&t.focus===n.focus}getSelection(){return{...this.selection_}}setSelection(t){t&&this.selection_&&t.anchor===this.selection_.anchor&&t.focus===this.selection_.focus||(this.selection_=t?{...t}:null)}isCollapsed(){return this.selection_&&this.selection_.anchor===this.selection_.focus}isBackward(){return this.selection_&&this.selection_.anchor>this.selection_.focus}move(t){}};r(de,"EVENT_TYPE",{SELECTION_CHANGE:"selection-change"});let d=de;const ue=class ue extends F(){constructor(t){super();r(this,"spacers_");r(this,"textChangeEmit_");this.spacers_=t||"",this.textChangeEmit_=l(()=>{this.emit(ue.EVENT_TYPE.TEXT_CHANGE)})}getSpacer(){return this.spacers_}getLength(){return this.spacers_.length}insert(t,n){const i=this.spacers_;this.spacers_=i.slice(0,t)+n+i.slice(t),this.textChangeEmit_()}remove(t,n){const i=this.spacers_;return t>n&&([t,n]=[n,t]),this.spacers_=i.slice(0,t)+i.slice(n),this.textChangeEmit_(),i.slice(t,n)}getLineByIndex(t){t--;let n="";for(;t>=0&&this.spacers_[t]!==`
`;)n=this.spacers_[t]+n,t--;return n}setContent(t){this.spacers_=t,this.textChangeEmit_()}clear(){this.spacers_="",this.textChangeEmit_()}};r(ue,"EVENT_TYPE",{TEXT_CHANGE:"text-change"});let h=ue;class f{constructor(){}apply(e){}inverse(){}}const v=f;class x extends v{constructor(t,n){super();r(this,"spacers_");r(this,"insertIndex_");this.spacers_=t,this.insertIndex_=n}apply(t){t.getTextModel().insert(this.insertIndex_,this.spacers_)}inverse(){return new R(this.insertIndex_,this.insertIndex_+this.spacers_.length)}getSapcers(){return this.spacers_}getInsertIndex_(){return this.insertIndex_}}const S=x;class E extends v{constructor(t,n){super();r(this,"startIndex_");r(this,"endIndex_");r(this,"removeText_");this.startIndex_=t,this.endIndex_=n}apply(t){this.removeText_=t.getTextModel().remove(this.startIndex_,this.endIndex_)}inverse(){return new S(this.removeText_,this.startIndex_)}getStartIndex(){return this.startIndex_}getEndIndex(){return this.endIndex_}}const R=E;class Y extends v{constructor(t){super();r(this,"selection_");r(this,"oldSelection_");this.selection_=t}static merge(t,n){const i=new Y(n.getSelection());return i.setOldSelection(t.getOldSelection()),i}apply(t){this.setOldSelection(t.getSelectionModel().getSelection()),t.getSelectionModel().setSelection(this.selection_)}inverse(){return new Y(this.oldSelection_)}getSelection(){return this.selection_}getOldSelection(){return this.oldSelection_}setOldSelection(t){this.oldSelection_=t}}var u,M;(M=u||(u={})).Document="document",M.BlockQuote="blockQuote",M.List="list",M.Item="item",M.Paragraph="paragraph",M.Head="head",M.Table="table",M.TableThead="tableThead",M.TableTh="tableTh",M.TableTbody="tableTbody",M.TableTr="tableTr",M.TableTd="tableTd",M.Emph="emph",M.Strong="strong",M.Link="link",M.Image="image",M.CustomInline="customInline",M.CustomBlock="customBlock",M.CodeBlock="codeBlock",M.HtmlBlock="htmlBlock",M.ThematicBreak="thematicBreak",M.Text="text",M.Underline="underline",M.Checkbox="checkbox",M.Del="del",M.Code="code";const L=class{constructor(s){r(this,"type");r(this,"parent",null);r(this,"firstChild",null);r(this,"lastChild",null);r(this,"prev",null);r(this,"next",null);r(this,"open",!0);r(this,"stringContent","");r(this,"sourceStart");r(this,"sourceEnd");r(this,"blockMarkerBefore","");r(this,"blockMarkerAfter","");r(this,"marker","");r(this,"isShow",!0);this.sourceStart=s}unlink(){this.prev?this.prev.next=this.next:this.parent&&(this.parent.firstChild=this.next),this.next?this.next.prev=this.prev:this.parent&&(this.parent.lastChild=this.prev),this.parent=null,this.next=null,this.prev=null}appendChild(s){s.unlink(),s.parent=this,this.lastChild?(this.lastChild.next=s,s.prev=this.lastChild,this.lastChild=s):this.firstChild=this.lastChild=s}prependChild(s){s.unlink(),s.parent=this,this.firstChild?(this.firstChild.prev=s,s.next=this.firstChild,this.firstChild=s):(this.firstChild=s,this.lastChild=s)}insertAfter(s){s.unlink(),s.next=this.next,s.next&&(s.next.prev=s),s.prev=this,this.next=s,s.parent=this.parent,!s.next&&s.parent&&(s.parent.lastChild=s)}insertBefore(s){s.unlink(),s.prev=this.prev,s.prev&&(s.prev.next=s),s.next=this,this.prev=s,s.parent=this.parent,!s.prev&&s.parent&&(s.parent.firstChild=s)}setStringContent(s){this.stringContent=s}getStringContent(){return this.stringContent}continue(s,e,t){return null}finalize(s){this.open=!1,s&&(this.sourceEnd=s)}canContain(s){return!1}};function le(s){switch(s){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";default:return s}}function j(s,e,t,n,i){let o,a=0;for(;n>0&&(o=s[e]);)if(o==="	")if(a=4-t%4,i){const c=a>n,g=c?n:a;e+=c?0:1,t+=g,n-=g}else t+=a,a=0,e+=1,n-=1;else e+=1,t+=1,n-=1;return{offset:e,column:t,spaceInTab:a}}function te(s){const e=s.match(/^\s+/);return e?e[0]:""}function ie(s){const e=new RegExp('[&<>"]',"g");return e.test(s)?s.replace(e,le):s}const Be=class extends L{constructor(e){super(e);r(this,"isContainer",!0);r(this,"isBlockContainer",!0);r(this,"canContainText",!1);r(this,"isParagraph",!0);this.type=u.BlockQuote}continue(e,t,n){let i=null;if(e[t]===">"){let o=j(e,t,n,1);i={offset:o.offset,column:o.column,spaceInTab:o.spaceInTab}}return i}canContain(e){return e.type!==u.Item}},Ie=class extends L{constructor(e,t,n){super(e);r(this,"isContainer",!0);r(this,"isBlockContainer",!1);r(this,"canContainText",!0);r(this,"isParagraph",!0);r(this,"lang");r(this,"char","```");this.type=u.CodeBlock,this.lang=t,this.char=n,this.blockMarkerBefore=n}continue(e,t,n){let i=null;const o=e.slice(t);if(o==="```"||o==="~~~"){this.blockMarkerAfter=this.blockMarkerBefore;const a=j(e,t,n,3);i={end:!0,offset:a.offset,column:a.column,spaceInTab:a.spaceInTab}}else i={offset:-1,column:-1,spaceInTab:-1};return i}canContain(e){return!1}},Me=class extends L{constructor(e){super(e);r(this,"isContainer",!0);r(this,"isBlockContainer",!1);r(this,"canContainText",!1);r(this,"isParagraph",!0);this.type=u.Document}continue(e,t,n){return{offset:-1,column:-1,spaceInTab:-1}}canContain(e){return e.type!==u.Item}},Ne=class extends L{constructor(e){super(e);r(this,"isContainer",!0);r(this,"isBlockContainer",!1);r(this,"canContainText",!0);r(this,"isParagraph",!1);this.type=u.Emph}},Pe=class extends L{constructor(e,t){super(e);r(this,"isContainer",!0);r(this,"isBlockContainer",!1);r(this,"canContainText",!0);r(this,"isParagraph",!0);r(this,"level",1);this.type=u.Head,this.level=t,this.blockMarkerBefore="#".repeat(t)+" "}continue(e,t,n){return null}canContain(e){return!1}},He=class extends L{constructor(e,t,n){super(e);r(this,"isContainer",!1);r(this,"isBlockContainer",!1);r(this,"canContainText",!0);r(this,"isParagraph",!0);r(this,"htmlContent","");r(this,"isCloseTag");this.type=u.HtmlBlock,this.htmlContent=t,this.isCloseTag=n}continue(e,t,n){return{offset:-1,column:-1,spaceInTab:-1}}canContain(e){return!1}},Oe=class extends L{constructor(e,t){super(e);r(this,"isContainer",!0);r(this,"isBlockContainer",!1);r(this,"canContainText",!0);r(this,"isParagraph",!1);r(this,"src");this.type=u.Image,this.src=t}},Ae=class extends L{constructor(e,t){super(e);r(this,"isContainer",!0);r(this,"isBlockContainer",!1);r(this,"canContainText",!0);r(this,"isParagraph",!1);r(this,"href");this.type=u.Link,this.href=t}},De=class extends L{constructor(e,t,n,i,o,a){super(e);r(this,"isContainer",!0);r(this,"isBlockContainer",!0);r(this,"canContainText",!1);r(this,"isParagraph",!0);r(this,"column",0);r(this,"start","1");r(this,"listType","bullet");r(this,"bulletChar","-");r(this,"delimiter",".");this.type=u.List,this.column=o,this.listType=t,this.bulletChar=n,this.delimiter=i,this.start=a}continue(e,t,n){let i=null;return i={offset:-1,column:-1,spaceInTab:-1},i}canContain(e){return e.type===u.Item}},we=class extends L{constructor(e,t,n,i,o){super(e);r(this,"isContainer",!0);r(this,"isBlockContainer",!0);r(this,"canContainText",!1);r(this,"isParagraph",!0);r(this,"column",0);r(this,"listType","bullet");r(this,"bulletChar","-");r(this,"delimiter",".");r(this,"listStyle","");this.type=u.Item,this.column=o,this.listType=t,this.bulletChar=n,this.delimiter=i}continue(e,t,n){if(e==="")return null;let i=null;return n-2>=this.column&&(i={offset:t,column:n,spaceInTab:-1}),i}canContain(e){return e.type!==u.Item}},Re=class extends L{constructor(e){super(e);r(this,"isContainer",!0);r(this,"isBlockContainer",!1);r(this,"canContainText",!0);r(this,"isParagraph",!0);this.type=u.Paragraph}continue(e,t,n){return null}finalize(e){super.finalize(e)}canContain(e){return!1}},Ve=class extends L{constructor(e){super(e);r(this,"isContainer",!0);r(this,"isBlockContainer",!1);r(this,"canContainText",!0);r(this,"isParagraph",!1);this.type=u.Strong}},V=class extends L{constructor(e,t){super(e);r(this,"isContainer",!1);r(this,"isBlockContainer",!1);r(this,"canContainText",!0);r(this,"isParagraph",!1);r(this,"text");this.type=u.Text,this.text=t,this.sourceEnd=e+t.length}},je=class extends L{constructor(e){super(e);r(this,"isContainer",!1);r(this,"isBlockContainer",!1);r(this,"canContainText",!0);r(this,"isParagraph",!0);this.type=u.ThematicBreak}continue(e,t,n){return null}canContain(e){return!1}},ze=class extends L{constructor(e){super(e);r(this,"isContainer",!0);r(this,"isBlockContainer",!1);r(this,"canContainText",!0);r(this,"isParagraph",!1);this.type=u.Del}},Ye=class extends L{constructor(e){super(e);r(this,"isContainer",!0);r(this,"isBlockContainer",!0);r(this,"canContainText",!1);r(this,"isParagraph",!0);r(this,"aligns",[]);this.type=u.Table}continue(e,t,n){let i=null;return e.length&&(i={offset:-1,column:-1,spaceInTab:-1}),i}canContain(e){return e.type===u.TableThead||e.type===u.TableTbody}},Ue=class extends L{constructor(e){super(e);r(this,"isContainer",!0);r(this,"isBlockContainer",!0);r(this,"canContainText",!1);r(this,"isParagraph",!0);this.type=u.TableThead}continue(e,t,n){let i=null,o=e.slice(t);const a=o.replace(/\s/g,"").split("|");let c=this.parent;for(let N of a)if(N){const O=N[0]===":",U=N[N.length-1]===":";let K="left";O&&U?K="center":!O&&U&&(K="right"),c.aligns.push(K)}const g=j(e,t,n,o.length);return i={end:!0,offset:g.offset,column:g.column,spaceInTab:g.spaceInTab},i}canContain(e){return!1}},fe=class extends L{constructor(e,t=!1){super(e);r(this,"isContainer",!0);r(this,"isBlockContainer",!1);r(this,"canContainText",!0);r(this,"isParagraph",!0);r(this,"isheader",!1);this.type=u.TableTr,this.isheader=t}continue(e,t,n){return null}canContain(e){return!1}},Ke=class extends L{constructor(e,t="left"){super(e);r(this,"isContainer",!0);r(this,"isBlockContainer",!1);r(this,"canContainText",!0);r(this,"isParagraph",!0);r(this,"align","");this.type=u.TableTh,this.align=t}continue(e,t,n){return null}},Fe=class extends L{constructor(e){super(e);r(this,"isContainer",!0);r(this,"isBlockContainer",!0);r(this,"canContainText",!1);r(this,"isParagraph",!0);this.type=u.TableTbody}continue(e,t,n){let i=null;return i={offset:-1,column:-1,spaceInTab:-1},i}canContain(e){return e.type===u.TableTr}},Ze=class extends L{constructor(e,t="left"){super(e);r(this,"isContainer",!0);r(this,"isBlockContainer",!1);r(this,"canContainText",!0);r(this,"isParagraph",!0);r(this,"align","");this.type=u.TableTd,this.align=t}continue(e,t,n){return null}},Ge=class extends L{constructor(e,t=!1){super(e);r(this,"isContainer",!1);r(this,"isBlockContainer",!1);r(this,"canContainText",!1);r(this,"isParagraph",!1);r(this,"checked",!1);this.type=u.Checkbox,this.checked=t}},$e=class extends L{constructor(e,t){super(e);r(this,"isContainer",!1);r(this,"isBlockContainer",!1);r(this,"canContainText",!0);r(this,"isParagraph",!1);r(this,"content","");this.type=u.Code,this.content=t}},J=class{constructor(){r(this,"next")}setNext(s){this.next=s}complete(s){let e=this.canComplete(s);return!e&&this.next&&(e=this.next.complete(s)),e}canComplete(s){return null}delete(s){let e=this.canDelete(s);return!e&&this.next&&(e=this.next.delete(s)),e}canDelete(s){return null}create(s){let e=this.canCreate(s);return!e&&this.next&&(e=this.next.create(s)),e}canCreate(s){return null}},Xe=class extends J{canCreate(s){let e=null;const t=s.line.slice(s.offset).match(/^#{1,6}(?:[ \t]+)/);if(t){const n=j(s.line,s.offset,s.column,t[0].length);e={offset:n.offset,column:n.column,spaceInTab:n.spaceInTab,mnode:new Pe(s.sourceStart,t[0].trim().length)}}return e}},oe=class oe extends J{canDelete(e){let t=null,n=e.line;const i=n.match(oe.reBlockQuoteMarker);let o=0;return i&&(n=n.slice(i[0].length),o=i[0].length),o>0&&(t={lineRest:n,deleteLen:o}),t}canComplete(e){let t=e.line,n=null;const i=t.match(oe.reBlockQuoteMarker);return i&&(t=t.slice(i[0].length),n=t.length?{completeInput:i[0],lineRest:t}:{completeInput:"",lineRest:t,needDeleteTab:!0}),n}canCreate(e){let t=null,n=e.line[e.offset];if(n===">"){let i=e.offset,o=e.column,a=0;const{offset:c,column:g,spaceInTab:N}=j(e.line,i,o,1);if(n=e.line[c],i=c,o=g,a=N,function(O){return O===" "||O==="	"}(n)){const O=j(e.line,c,g,1,!0);i=O.offset,o=O.column,a=O.spaceInTab}t={offset:i,column:o,spaceInTab:a,mnode:new Be(e.sourceStart)}}return t}};r(oe,"reBlockQuoteMarker",/^>\s*/);let _e=oe;const qe=_e,ae=class ae extends J{canComplete(e){let t=e.line;const n=t.match(ae.reCodeBlock);let i=null;if(n){let o=`
`+n[0]+`
`;t=t.slice(n[0].length),i={completeInput:o,lineRest:t,cursor:0}}return i}canDelete(e){return null}canCreate(e){let t=null,n=e.line.slice(e.offset);if(this.maybeCodeBlock_(n,e.nextLine)){const i=n.match(ae.reCodeBlock);if(i){let o=j(e.line,e.offset,e.column,i[0].length);const a=e.line.slice(o.offset);o=j(e.line,o.offset,o.column,a.length),t={offset:o.offset,column:o.column,spaceInTab:o.spaceInTab,mnode:new Ie(e.sourceStart,a,e.line+`
`)}}}return t}maybeCodeBlock_(e,t){return t!==void 0}};r(ae,"reCodeBlock",/^`{3,}(?!.*`)|^~{3,}/);let me=ae;const We=me,Qe=class extends J{canCreate(s){return null}},Je=class extends J{canCreate(s){return null}},Z=class Z extends J{canDelete(e){let t=null,n=e.line,i=0,o="bullet",a=n.match(Z.reBulletListMarker);if(a||(a=n.match(Z.reOrderedListMarker),o="ordered"),a&&(n=n.slice(a[0].length),i=a[0].length,o==="bullet")){const c=n.match(/^\s*\[(?:[x X])\]\s/);c&&(n=n.slice(c[0].length),i+=c[0].length)}return i>0&&(t={lineRest:n,deleteLen:i}),t}canComplete111(e){let t=e.line;t.match(Z.reBulletListMarker);let n,i="",o="",a=0;for(;(n=t.match(Z.reBulletListMarker))||(n=t.match(Z.reOrderedListMarker));)if(t=t.slice(n[0].length),t.length){const c=t.match(/^\s+/);c&&(t=t.slice(c[0].length),t.length&&(o=c[0],a+=o.length)),t.length&&(i=n[0],a+=i.length)}return null}canComplete(e){let t=e.line,n=t.match(Z.reBulletListMarker),i=null,o=null;if(n){if(t=t.slice(n[0].length),t){let a=n[0];const c=t.match(/^\[(?:[x X])\]\s/);c&&(t=t.slice(c[0].length),t&&(a+=c[0])),t&&(o={completeInput:a,lineRest:t})}}else if(i=t.match(Z.reOrderedListMarker),i&&(t=t.slice(i[0].length),t)){const a=i[0].split(".");o={completeInput:parseInt(a[0])+1+"."+a[1],lineRest:t}}return!n&&!i||t||(o={completeInput:"",lineRest:t,needDeleteTab:!0}),o}canCreate(e){let t,n=null,i=null;const o=this.matchList_(e.line,e.offset);if(o){e.container.type===u.List&&this.isSameList_(e.container,o)||(i=new De(e.sourceStart,o.listType,o.bulletChar,o.delimiter,e.column,o.start));const a=new we(e.sourceStart,o.listType,o.bulletChar,o.delimiter,e.column);i?(i.appendChild(a),t=i):t=a;const c=j(e.line,e.offset,e.column,o.offset);n={offset:c.offset,column:c.column,spaceInTab:c.spaceInTab,mnode:t}}return n}isSameList_(e,t){return e.listType===t.listType&&e.delimiter===t.delimiter&&e.bulletChar===t.bulletChar}matchList_(e,t){let n="",i="",o="",a="1";const c=e.slice(t);let g=c.match(Z.reBulletListMarker);if(g)n="bullet",i=g[0][0];else{if(g=c.match(Z.reOrderedListMarker),!g)return null;a=g[1],n="ordered",o=g[2]}return{listType:n,bulletChar:i,delimiter:o,offset:g[0].length,start:a}}};r(Z,"reBulletListMarker",/^([*+-]\s)/),r(Z,"reOrderedListMarker",/^(\d{1,9})([.)])\s/);let ge=Z;const et=ge,tt=class extends J{canCreate(s){return null}},nt=class extends J{canCreate(s){let e=null,t=s.line.slice(s.offset).replace(/\s/g,"");if(this.maybeThematicBreak_(t,s.nextLine)&&t.match(/^(?:\*){3,}$|^(?:_){3,}$|^(?:-){3,}$/)){const n=j(s.line,s.offset,s.column,s.line.length-s.offset);e={offset:n.offset,column:n.column,spaceInTab:n.spaceInTab,mnode:new je(s.sourceStart)}}return e}maybeThematicBreak_(s,e){return e!==void 0}},st=class extends J{canCreate(s){let e=null,t=s.line.slice(s.offset);if(t){const n=s.container.type;let i;if(n===u.Table){const o=new Fe(s.sourceStart),a=new fe(s.sourceStart);a.stringContent=t,o.appendChild(a),i=o}else if(n===u.TableTbody){const o=new fe(s.sourceStart);o.stringContent=t,i=o}else if(this.maybeTable_(t,s.nextLine)){const o=new Ye(s.sourceStart),a=new Ue(s.sourceStart),c=new fe(s.sourceStart,!0);c.stringContent=t,a.appendChild(c),o.appendChild(a),i=o}if(i){const o=j(s.line,s.offset,s.column,t.length);e={offset:o.offset,column:o.column,spaceInTab:o.spaceInTab,mnode:i}}}return e}maybeTable_(s,e){if((s=s.replace(/\\\|/g,"**"))&&s.indexOf("|")>-1&&s.indexOf("- ")!==0&&e){const t=te(e);if(t&&(e=e.slice(t.length)),e[0]!="|"&&(e="|"+e),e.match(/^(\|\s*:?-+:?\s*)+\|?$/)&&(s[0]==="|"&&(s=s.slice(1)),s[s.length-1]==="|"&&(s=s.slice(0,-1)),e[0]==="|"&&(e=e.slice(1)),e[e.length-1]==="|"&&(e=e.slice(0,-1)),s.split("|").length===e.split("|").length))return!0}return!1}},Te=class{build(){const s=new Xe,e=new qe,t=new We,n=new Qe,i=new Je,o=new et,a=new tt,c=new nt,g=new st;return s.setNext(e),e.setNext(t),t.setNext(n),n.setNext(i),i.setNext(o),o.setNext(a),a.setNext(c),c.setNext(g),s}},it=new RegExp(`^(?:<[A-Za-z][A-Za-z0-9-]*(?:\\s+[a-zA-Z_:][a-zA-Z0-9:._-]*(?:\\s*=\\s*(?:[^"'=<>\`\\x00-\\x20]+|'[^']*'|"[^"]*"))?)*\\s*/?>|</[A-Za-z][A-Za-z0-9-]*\\s*[>]|<!---->|<!--(?:-?[^>-])(?:-?[^-])*-->|[<][?][\\s\\S]*?[?][>]|<![A-Z]+\\s+[^>]*>|<!\\[CDATA\\[[\\s\\S]*?\\]\\]>)`),ke=class{constructor(s,e,t,n,i){r(this,"char");r(this,"count");r(this,"currentCount");r(this,"mnode");r(this,"pre",null);r(this,"next",null);r(this,"canOpen");r(this,"canClose");this.char=s,this.count=e,this.currentCount=e,this.mnode=t,this.canOpen=n,this.canClose=i}static removeBetween(s,e){s.next!==e&&(s.next=e,e.pre=s)}remove(){this.pre!==null&&(this.pre.next=this.next),this.next!==null&&(this.next.pre=this.pre)}},ne=class ne{constructor(){r(this,"block_");r(this,"line_");r(this,"sourceStart_");r(this,"offset_");r(this,"delimiter_",null);r(this,"aligns_",[])}parse(e){var t;this.block_=e,this.setBlockMarkerBefore_(),this.line_=e.stringContent||"",this.line_.length!==0||((t=this.block_.prev)==null?void 0:t.type)!==u.Table?(this.offset_=0,this.delimiter_=null,this.parseLine_(),this.transNormal_(null),this.setBlockMarkerAfter_()):this.block_.isShow=!1}parseLine_(){if(this.block_.type===u.CodeBlock)return void this.block_.appendChild(new V(this.sourceStart_+1,this.line_));if(!this.line_)return void this.block_.appendChild(new V(this.sourceStart_,""));if(this.block_.type===u.TableTr){const n=this.block_.parent.parent;this.aligns_=[...n.aligns]}const e=this.block_.parent;if(e&&e instanceof we&&e.listType==="bullet"){const n=this.line_.match(/^\[(?:[x X])\]\s+/);if(n){e.listStyle="none";const i=n[0],o=new Ge(this.sourceStart_,i.indexOf("[ ]")===-1);this.block_.appendChild(o),this.offset_+=i.length-1,o.finalize(this.sourceStart_+this.offset_)}}let t;for(;t=this.line_[this.offset_];)switch(t){case"*":case"_":case"~":this.parseNormal_(t);break;case"[":this.parseOpenBracket_();break;case"]":this.parseCloseBracket_();break;case"!":this.parseExclamatory_();break;case"|":this.parseVertical_();break;case"\\":this.parseBackslash_();break;case"<":this.parseHtmlTag_();break;case"`":this.parseBackticks_();break;default:this.parseText_()}for(;this.aligns_.length;)this.parseVertical_()}parseText_(){const e=this.match_(ne.textReg);e&&this.block_.appendChild(new V(this.sourceStart_+this.offset_-e.length,e))}parseNormal_(e){let t=0,n=this.offset_,i=!1,o=!1;for(;this.line_[this.offset_]===e;)t++,this.offset_++;this.line_[this.offset_]&&!ne.whiteSpaceReg.test(this.line_[this.offset_])&&(i=!0),n>0&&!ne.whiteSpaceReg.test(this.line_[n-1])&&(o=!0),this.stackPush_(this.line_.substr(n,t),e,t,i,o)}transNormal_(e){let t=this.delimiter_,n=null,i={};for(;t!==null&&t.pre!==e;)t=t.pre;for(;t;){const o=t.char;if(!t.canClose||o!=="*"&&o!=="_"&&o!=="~")t=t.next;else if(n=this.transNormalOpener_(t,i[t.char]||e),n){let a,c;const g=n.mnode,N=t.mnode;o==="*"||o==="_"?n.currentCount>=2&&t.currentCount>=2?(c=2,a=new Ve(g.sourceEnd)):(c=1,a=new Ne(g.sourceEnd)):(c=1,a=new ze(g.sourceEnd)),a.finalize(N.sourceStart),n.currentCount-=c,g.sourceEnd-=c,t.currentCount-=c,N.sourceStart+=c,g.text=g.text.slice(c),N.text=N.text.slice(c);let O,U=g.next;for(;U&&U!==N;)O=U.next,a.appendChild(U),U=O;g.insertAfter(a);let K=o.repeat(c);if(this.addMarkerNode_(a,K,K),ke.removeBetween(n,t),n.currentCount===0&&(n.remove(),g.unlink()),t.currentCount===0){const wt=t.next;this.delimiter_===t&&(this.delimiter_=t.pre),t.remove(),t=wt,N.unlink()}}else{const a=t;t=t.next,i[a.char]=a.pre,a.canOpen||(this.delimiter_===a&&(this.delimiter_=a.pre),a.remove())}}}transNormalOpener_(e,t){let n=e.pre;for(;n&&n!==t;){if(n.canOpen&&n.char===e.char)return n;n=n.pre}return null}parseOpenBracket_(){this.offset_++,this.stackPush_("[","[",1,!0,!1)}parseCloseBracket_(){let e=this.delimiter_,t=!1;for(;e&&e.char!=="[";){if(e.char==="!["){t=!0;break}e=e.pre}if(!e)return void this.block_.appendChild(new V(this.sourceStart_+this.offset_,"]"));this.offset_++;let n=!1,i=this.offset_,o="";if(this.line_[this.offset_]==="("){let a;for(this.offset_++;a=this.line_[this.offset_];){if(this.offset_++,a===")"){n=!0;break}o+=a}}if(n){const a=t?new Oe(e.mnode.sourceEnd,o):new Ae(e.mnode.sourceEnd,o);let c,g=e.mnode.next;for(;g;)c=g.next,g.unlink(),a.appendChild(g),g=c;if(this.block_.appendChild(a),this.transNormal_(e.pre),a.finalize(this.sourceStart_+i-1),this.addMarkerNode_(a,e.char,"]("+o+")"),this.delimiter_===e&&(this.delimiter_=e.pre),e.remove(),e.mnode.unlink(),!t)for(e=this.delimiter_;e;){const N=e.pre;e.char==="["&&e.remove(),e=N}}else this.delimiter_===e&&(this.delimiter_=e.pre),e.remove(),this.offset_=i,this.block_.appendChild(new V(this.sourceStart_+this.offset_-1,"]"))}parseExclamatory_(){if(this.offset_++,this.line_[this.offset_]==="["){const e="![";this.offset_++,this.stackPush_(e,e,2,!0,!1)}else this.block_.appendChild(new V(this.sourceStart_+this.offset_-1,"!"))}parseVertical_(){if(this.block_.type!==u.TableTr)return void(this.line_[this.offset_]&&(this.block_.appendChild(new V(this.sourceStart_+this.offset_,"|")),this.offset_++));this.line_[this.offset_]&&this.offset_++;let e,t,n=this.delimiter_;for(;n&&n.char!=="|";)n=n.pre;let i=!1;if(n?(e=n.mnode.sourceEnd,t=n.mnode.next,i=!0):this.block_.lastChild&&(e=this.block_.firstChild.sourceStart,t=this.block_.firstChild,i=!0),i){const o=this.block_.isheader?new Ke(e,this.aligns_.shift()||"left"):new Ze(e,this.aligns_.shift()||"left");let a;for(;t;)a=t.next,t.unlink(),o.appendChild(t),t=a;this.block_.appendChild(o),this.transNormal_(n),o.finalize(this.sourceStart_+this.offset_-1),n&&(this.delimiter_===n&&(this.delimiter_=n.pre),n.remove(),n.mnode.unlink())}if(this.aligns_.length){const o="|";this.stackPush_(o,o,1,!0,!0)}else this.offset_=this.line_.length}parseBackslash_(){this.offset_++;const e=this.line_[this.offset_];if(new RegExp("^[!\"#$%&'()*+,./:;<=>?@[\\\\\\]^_`{|}~-]").test(e)){const t=new V(this.sourceStart_+this.offset_,e);this.block_.appendChild(t),this.addMarkerNode_(t,"\\"),this.offset_++}else this.block_.appendChild(new V(this.sourceStart_+this.offset_-1,"\\"))}parseHtmlTag_(){const e=this.line_.slice(this.offset_).match(it);if(e){const t=e[0].indexOf("</")===0,n=new He(this.sourceStart_+this.offset_,e[0],t);this.block_.appendChild(n),this.offset_+=e[0].length,n.finalize(this.sourceStart_+this.offset_)}else this.block_.appendChild(new V(this.sourceStart_+this.offset_,"<")),this.offset_++}parseBackticks_(){let e=this.line_.slice(this.offset_).match(/^`+/);if(e){const t=e[0];this.offset_+=t.length;let n=this.offset_;for(;e=this.line_.slice(this.offset_).match(/`+/);)if(this.offset_+=e.index+e[0].length,e[0]===t){const i=this.line_.slice(n,this.offset_-e[0].length),o=new $e(this.sourceStart_+n,i);return o.finalize(this.sourceStart_+this.offset_-e[0].length),this.block_.appendChild(o),void this.addMarkerNode_(o,t,t)}this.block_.appendChild(new V(this.sourceStart_+n-t.length,t)),this.offset_=n}}stackPush_(e,t,n,i,o){const a=new V(this.sourceStart_+this.offset_-n,e);if(this.block_.appendChild(a),i||o){const c=new ke(t,n,a,i,o);this.delimiter_&&(this.delimiter_.next=c,c.pre=this.delimiter_),this.delimiter_=c}}setBlockMarkerBefore_(){const e=this.block_.blockMarkerBefore;if(e){const t=new V(this.block_.sourceStart,e);t.marker="before",this.block_.appendChild(t),this.sourceStart_=t.sourceEnd}else this.sourceStart_=this.block_.sourceStart}setBlockMarkerAfter_(){const e=this.block_.blockMarkerAfter;if(e){const t=new V(this.block_.sourceEnd-e.length,e);t.marker="after",this.block_.appendChild(t)}}addMarkerNode_(e,t,n){if(t){const i=new V(e.sourceStart-t.length,t);i.marker="before",e.insertBefore(i)}if(n){const i=new V(e.sourceEnd,n);i.marker="after",e.insertAfter(i)}}match_(e){const t=e.exec(this.line_.slice(this.offset_));return t?(this.offset_+=t[0].length,t[0]):null}};r(ne,"whiteSpaceReg",/^\s/),r(ne,"textReg",/^[^\[\]\|\\<!*_~`]+/m),r(ne,"spnlReg",/^\s*(?:\n*)?/);let be=ne;const rt=be;class ot{createTag_(e,t,n){let i=`<${e}`;if(t)for(let o of t)i+=` ${o[0]}="${o[1]}"`;return n&&(i+=" /"),i+=">",i}getSource_(e,t=[]){return t.push(["i",String(e.sourceStart||0)+"-"+String(e.sourceEnd||0)]),e.isParagraph&&t.push(["class","editor-block"]),t}[u.BlockQuote](e,t,n){return e+(n?this.createTag_("/blockquote"):this.createTag_("blockquote",this.getSource_(t)))}[u.CodeBlock](e,t,n){if(n)e+=this.createTag_("/code"),e+=this.createTag_("/pre");else{const i=this.getSource_(t);for(let o of i)if(o[0]==="class"){o[1]+=" code-block";break}e+=this.createTag_("pre",i),e+=this.createTag_("code",i)}return e}[u.Emph](e,t,n){return e+(n?this.createTag_("/em"):this.createTag_("em",this.getSource_(t)))}[u.Head](e,t,n){const i="h"+t.level;return e+(n?this.createTag_("/"+i):this.createTag_(i,this.getSource_(t)))}[u.HtmlBlock](e,t,n){return e+ie(t.htmlContent)}[u.Image](e,t,n){if(n)e+='" />';else{const i=[["src",ie(t.src)]];let o=this.createTag_("img",this.getSource_(t,i));o=o.substr(0,o.length-1),o+=' alt="',e+=o}return e}[u.Link](e,t,n){const i=[["href",t.href]];return e+(n?this.createTag_("/a"):this.createTag_("a",this.getSource_(t,i)))}[u.List](e,t,n){const i=t.listType==="bullet"?"ul":"ol";if(n)e+=this.createTag_("/"+i);else{const o=[];i==="ol"&&o.push(["start",t.start]),e+=this.createTag_(i,o)}return e}[u.Item](e,t,n){if(n)e+=this.createTag_("/li");else{const i=this.getSource_(t);if(t.listStyle==="none"){for(let o of i)if(o[0]==="class"){o[1]+=" list-style-none";break}}e+=this.createTag_("li",i)}return e}[u.Paragraph](e,t,n){return t.isShow&&(e+=n?this.createTag_("/p"):this.createTag_("p",this.getSource_(t))),e}[u.Strong](e,t,n){return e+(n?this.createTag_("/strong"):this.createTag_("strong",this.getSource_(t)))}[u.Text](e,t,n){if(t.marker){const i=[["class","editor-marker hide"],["m",t.marker]];e+=this.createTag_("span",this.getSource_(t,i))+ie(t.text),e+=this.createTag_("/span")}else e+=t.text;return e}[u.ThematicBreak](e,t,n){return e+this.createTag_("hr",this.getSource_(t),!0)}[u.Del](e,t,n){return e+(n?this.createTag_("/del"):this.createTag_("del",this.getSource_(t)))}[u.Underline](e,t,n){return e}[u.Table](e,t,n){return e+(n?this.createTag_("/table"):this.createTag_("table",this.getSource_(t)))}[u.TableThead](e,t,n){return e+(n?this.createTag_("/thead"):this.createTag_("thead",this.getSource_(t)))}[u.TableTr](e,t,n){return e+(n?this.createTag_("/tr"):this.createTag_("tr",this.getSource_(t)))}[u.TableTh](e,t,n){if(n)e+=this.createTag_("/th");else{const i=[["align",t.align]];e+=this.createTag_("th",this.getSource_(t,i))}return e}[u.TableTbody](e,t,n){return e+(n?this.createTag_("/tbody"):this.createTag_("tbody",this.getSource_(t)))}[u.TableTd](e,t,n){if(n)e+=this.createTag_("/td");else{const i=[["align",t.align]];e+=this.createTag_("td",this.getSource_(t,i))}return e}[u.Checkbox](e,t,n){const i=[["type","checkbox"]];return t.checked&&i.push(["checked","checked"]),e+this.createTag_("input",this.getSource_(t,i),!0)}[u.Code](e,t,n){const i=this.getSource_(t,[["class","code-block-inline"]]);return e+=this.createTag_("code",i),(e+=t.content)+this.createTag_("/code")}}const at=ot,ye=class{constructor(s){r(this,"root_");r(this,"current_");r(this,"close_");this.root_=s,this.current_=s,this.close_=!1}next(){let s=this.current_,e=this.close_;return s===null?null:(!e&&s.isContainer?s.firstChild?(this.current_=s.firstChild,this.close_=!1):this.close_=!0:s===this.root_?this.current_=null:s.next===null?(this.current_=s.parent,this.close_=!0):(this.current_=s.next,this.close_=!1),{mnode:s,close:e})}},ve=new class{parseBlock_(s){return new class{constructor(){r(this,"doc_");r(this,"sourceIndex_");r(this,"offset_");r(this,"column_");r(this,"tip_");r(this,"blockParseCreater_",new Te().build());r(this,"currentLine_");r(this,"nextLine_");r(this,"blank_");r(this,"indent_");r(this,"spaceInTab_")}parse(e){this.doc_=new Me(0),this.tip_=this.doc_,this.sourceIndex_=0;const t=e.split(/\r\n|\n|\r/),n=t.length;for(let i=0;i<n;i++){const o=t[i];this.nextLine_=t[i+1],this.parseBlock_(o),this.sourceIndex_+=o.length+1}for(;this.tip_;)this.tip_.finalize(this.sourceIndex_-1),this.tip_=this.tip_.parent;return this.doc_}parseBlock_(e){this.offset_=0,this.column_=0,this.currentLine_=e;const t=this.beforeParse_();if(!t)return;let n;if(this.tip_=t,t.type!==u.CodeBlock)do if(this.dealSpace_(),n=this.blockParseCreater_.create({line:e,nextLine:this.nextLine_,offset:this.offset_,column:this.column_,container:this.tip_,sourceStart:this.sourceIndex_+this.offset_}),n&&(this.addChild_(n.mnode),this.fixOffsetAndColumn_(n.offset,n.column,n.spaceInTab),n.mnode.type===u.CodeBlock))return;while(n&&n.mnode.isBlockContainer&&this.currentLine_[this.offset_]);this.tip_.canContainText||this.addChild_(new Re(this.sourceIndex_+this.offset_)),this.addLineText_()}beforeParse_(){let e=this.doc_;const t=this.dealSpace_();for(this.indent_=t;e;){if(!e.open){e=e.parent;break}const n=e.continue(this.currentLine_,this.offset_,this.column_);if(!n){e=e.parent;break}if(this.fixOffsetAndColumn_(n.offset,n.column,n.spaceInTab),n.end)return void e.finalize(this.sourceIndex_+this.offset_);if(!e.lastChild)break;e=e.lastChild,this.dealSpace_()}for(;e!==this.tip_;)this.tip_.finalize(this.sourceIndex_-1),this.tip_=this.tip_.parent;return e}addChild_(e){for(;!this.tip_.canContain(e);)this.tip_.finalize(this.sourceIndex_-1),this.tip_=this.tip_.parent;this.tip_.appendChild(e);let t=e;for(;t;)this.tip_=t,t=t.lastChild}dealSpace_(){const e=this.currentLine_;let t,n=this.column_;for(;(t=e.charAt(this.offset_))!=="";)if(t===" ")this.offset_++,this.column_++;else{if(t!=="	")break;this.offset_++,this.column_+=4-this.column_%4}return this.blank_=t===`
`||t==="\r"||t==="",this.column_-n}fixOffsetAndColumn_(e,t,n){e>-1&&(this.offset_=e),t>-1&&(this.column_=t),n>-1&&(this.spaceInTab_=n)}addLineText_(){var t;let e=this.tip_.getStringContent()||"";if(this.spaceInTab_){this.offset_+=1;const n=4-this.column_%4;e+=" ".repeat(n)}this.tip_.type===u.CodeBlock?(e+=this.currentLine_,e+=`
`):this.tip_.type===u.Paragraph&&((t=this.tip_.parent)==null?void 0:t.type)===u.Document?(e+=this.currentLine_,this.tip_.sourceStart=this.sourceIndex_):e+=this.currentLine_.slice(this.offset_),this.tip_.setStringContent(e)}}().parse(s)}parseLine_(s){const e=new ye(s);let t;for(;t=e.next();)!t.close&&t.mnode.canContainText&&new rt().parse(t.mnode);return s}md2html(s){return new class{render(e,t){t||(t=new at);const n=new ye(e);let i,o="";for(;i=n.next();)t[i.mnode.type]&&(o=t[i.mnode.type](o,i.mnode,i.close)||"");return o}}().render(this.md2node(s))}md2node(s){return this.parseLine_(this.parseBlock_(s))}},pe=class pe extends F(){constructor(t,n,i){super();r(this,"textModel_");r(this,"selectionModel_");r(this,"viewContainer_");r(this,"renderBinder_");r(this,"domSelectionChangeHandlerBinder_");this.textModel_=t,this.selectionModel_=n,this.viewContainer_=i,this.viewContainer_.setAttribute("contenteditable","true"),this.addListeners()}domSelectionChangeHandler(t){const n=window.getSelection();let i=null;n&&(i=this.domSelToCustomSel(n)),this.showMarker(n),this.emit(pe.EVENT_TYPE.SELECTION_CHANGE,i)}updateDomSelection(){const t=window.getSelection();if(t){const n=this.selectionModel_.getSelection();t.removeAllRanges();const i=this.customSelToDomSel(n);i&&(t.addRange(i),this.showMarker(t))}}addListeners(){this.renderBinder_=this.render.bind(this),this.textModel_.on(h.EVENT_TYPE.TEXT_CHANGE,this.renderBinder_),this.domSelectionChangeHandlerBinder_=l(this.domSelectionChangeHandler.bind(this),100),window.document.addEventListener("selectionchange",this.domSelectionChangeHandlerBinder_)}customSelToDomSel(t){let n=null;if(t){const i=this.customPointToDomPoint(t.anchor),o=t.anchor===t.focus?i:this.customPointToDomPoint(t.focus);i&&o&&(n=window.document.createRange(),n.setStart(i.domNode,i.domOffset),n.setEnd(o.domNode,o.domOffset))}return n}domSelToCustomSel(t){let n={anchor:0,focus:0};if(t.anchorNode){const i=this.domPointToCustomPoint({domNode:t.anchorNode,domOffset:t.anchorOffset});n={anchor:i,focus:t.isCollapsed?i:this.domPointToCustomPoint({domNode:t.focusNode,domOffset:t.focusOffset})}}return n}customPointToDomPoint(t){let n,i=this.viewContainer_,o=0,a=null;for(;(n=i.childNodes)&&n.length!==0;){let c=null,g=null,N=n.length;for(let O=0;O<N;O++){const U=n[O],K=this.getNodeSource_(U);if(t>=K[0]&&t<=K[1]){i=U,o=t-K[0];break}if(t<K[0]){c?(i=c,o=t-g[0]):(i=U,o=0);break}if(O===N-1){i=U,o=K[1]-K[0];break}c=U,g=K}}return!(i instanceof Text)&&o>0&&(i.nextSibling?(i=i.nextSibling,o=0):(i=i.parentElement,o=i.childNodes.length)),a={domNode:i,domOffset:o},a}domPointToCustomPoint(t){let n=t.domNode;const i=this.getNodeSource_(n);let o=t.domOffset,a=i[0]+o;if(!(n instanceof Text)&&o>0){const c=n.childNodes;a=this.getNodeSource_(c[o-1])[1]}return a}getNodeSource_(t){const n=[0,0];if(t instanceof Text){const i=t.length;if(t.previousElementSibling){const o=t.previousElementSibling.getAttribute("i");if(o){const a=o.split("-");n[0]=parseInt(a[1]),n[1]=n[0]+i}}else if(t.parentElement){const o=t.parentElement.getAttribute("i");if(o){const a=o.split("-");n[0]=parseInt(a[0]),n[1]=n[0]+i}}}else{let i=t.getAttribute("i");if(!i){const o=t.childNodes;o.length&&(i=(t=o[0]).getAttribute("i"))}if(i){const o=i.split("-");n[0]=parseInt(o[0]),n[1]=parseInt(o[1])}}return n}showMarker(t){var i,o;const n=document.querySelectorAll(".editor-marker:not(.hide)");for(let a=0;a<n.length;a++)n[a].setAttribute("class","editor-marker hide");if(t){let a=t.anchorNode;for(a instanceof Text&&(a=a.parentNode);a;){let c=a.getAttribute("class");if(c==="web-editor-pre")break;if(c==="editor-block"){if(["H1","H2","H3","H4","H5","H6"].indexOf(a.tagName)>-1){const g=a.querySelectorAll(".editor-marker.hide");for(let N=0;N<g.length;N++)g[N].setAttribute("class","editor-marker")}break}if(c!=="editor-marker hide"&&(a.previousSibling?a=a.previousSibling:a.nextSibling&&(a=a.nextSibling)),!(a instanceof Text)){if(c=a.getAttribute("class"),c!=="editor-marker hide")break;{a.setAttribute("class","editor-marker");const g=a.getAttribute("m")==="before"?(i=a.nextSibling)==null?void 0:i.nextSibling:(o=a.previousSibling)==null?void 0:o.previousSibling;g&&g.setAttribute("class","editor-marker")}}a=a.parentNode}}}inDom(t){const n=window.getSelection();if(n){let i=n.anchorNode;for(;i;){if(!(i instanceof Text)){const o=i.getAttribute("class");if(o&&o.indexOf("web-editor-pre")>-1)break;if((i==null?void 0:i.tagName.toLowerCase())===t)return{sourceIndex:this.getNodeSource_(i)}}i=i.parentElement}}return null}render(){this.viewContainer_.innerHTML=ve.md2html(this.textModel_.getSpacer()),this.updateDomSelection()}dispose(){this.renderBinder_&&(this.textModel_.off(h.EVENT_TYPE.TEXT_CHANGE,this.renderBinder_),this.renderBinder_=null),this.domSelectionChangeHandlerBinder_&&(window.document.removeEventListener("selectionchange",this.domSelectionChangeHandlerBinder_),this.domSelectionChangeHandlerBinder_=null),this.viewContainer_.innerHTML=""}};r(pe,"EVENT_TYPE",{SELECTION_CHANGE:"selection-change"});let re=pe;const ce=re,Se=class extends ce{constructor(s,e,t){super(s,e,t),this.viewContainer_.setAttribute("contenteditable","false")}addListeners(){}render(){this.viewContainer_.innerHTML=ve.md2html(this.textModel_.getSpacer())}},lt=class extends ce{customSelToDomSel(s){return super.customSelToDomSel(s)}domSelToCustomSel(s){return super.domSelToCustomSel(s)}render(){super.render()}},ct=class extends ce{constructor(e,t,n){var o;super(e,t,n);r(this,"previewElement_");r(this,"sourceAndPreviewRenderBinder_");const i=document.createElement("pre");i.setAttribute("class","web-editor-pre preview"),(o=this.viewContainer_.parentElement)==null||o.appendChild(i),this.previewElement_=i}customPointToDomPoint(e){let t={domNode:this.viewContainer_,domOffset:0};return this.viewContainer_.childNodes.length&&(t={domNode:this.viewContainer_.childNodes[0],domOffset:e}),t}domPointToCustomPoint(e){return e.domOffset}showMarker(){}render(){this.viewContainer_.innerHTML=ie(this.textModel_.getSpacer())+`
`,this.updateDomSelection(),this.previewElement_&&(this.previewElement_.innerHTML=ve.md2html(this.textModel_.getSpacer()))}dispose(){super.dispose(),this.sourceAndPreviewRenderBinder_&&(this.textModel_.off(h.EVENT_TYPE.TEXT_CHANGE,this.sourceAndPreviewRenderBinder_),this.sourceAndPreviewRenderBinder_=null),this.previewElement_&&(this.previewElement_.remove(),this.previewElement_=null)}},ht=class extends ce{customPointToDomPoint(s){let e={domNode:this.viewContainer_,domOffset:0};return this.viewContainer_.childNodes.length&&(e={domNode:this.viewContainer_.childNodes[0],domOffset:s}),e}domPointToCustomPoint(s){return s.domOffset}render(){this.viewContainer_.innerHTML=ie(this.textModel_.getSpacer())+`
`,this.updateDomSelection()}};var z;(function(s){s.PREVIEW="PREVIEW",s.RENDER="RENDER",s.SOURCE="SOURCE",s.SOURCE_AND_PREVIEW="SOURCE_AND_PREVIEW"})(z||(z={}));class dt{provide(e,t,n,i){switch(e){case z.PREVIEW:return new Se(t,n,i);case z.RENDER:return new lt(t,n,i);case z.SOURCE:return new ht(t,n,i);case z.SOURCE_AND_PREVIEW:return new ct(t,n,i);default:return new Se(t,n,i)}}}const xe=class{constructor(s,e){r(this,"isComposing",!1);r(this,"editor");r(this,"target");r(this,"view");r(this,"eventList_",[]);this.editor=s,this.target=s.getElement(),this.view=e}compositionStartHandler(s){this.isComposing=!0}compositionEndHandler(s){this.isComposing=!1}getComposing(){return this.isComposing}cacheEventHandler(s){this.eventList_.push(s)}addListeners(){const s=this.compositionStartHandler.bind(this),e=this.compositionEndHandler.bind(this);this.target.addEventListener("compositionstart",s),this.target.addEventListener("compositionend",e),this.cacheEventHandler({type:"compositionstart",listener:s}),this.cacheEventHandler({type:"compositionend",listener:e})}dispose(){for(let s of this.eventList_)this.target.removeEventListener(s.type,s.listener);this.eventList_=[]}};var ee=B(985);const ut=typeof navigator<"u"&&/Mac OS X/.test(navigator.userAgent),G=class G{constructor(){}static getInstance(){return this.instance||(this.instance=new G),this.instance}isMoveBackward(e){return G.IS_KEYS.moveBackward(e)}isMoveForward(e){return G.IS_KEYS.moveForward(e)}isDeleteBackward(e){return G.IS_KEYS.deleteBackward(e)}isDeleteForward(e){return G.IS_KEYS.deleteForward(e)}isTab(e){return G.IS_KEYS.isTab(e)}isRedo(e){return G.IS_KEYS.redo(e)}isUndo(e){return G.IS_KEYS.undo(e)}isChangeMode(e){return G.IS_KEYS.changeMode(e)}};r(G,"IS_KEYS",{moveBackward:(0,ee.TB)("left"),moveForward:(0,ee.TB)("right"),deleteBackward:(0,ee.TB)("shift?+backspace"),deleteForward:(0,ee.TB)("shift?+delete"),isTab:(0,ee.TB)("tab"),undo:(0,ee.TB)("mod+z"),redo:ut?(0,ee.TB)("cmd+shift+z"):(0,ee.TB)("ctrl+y"),changeMode:(0,ee.TB)("mod+/")}),r(G,"instance");let Ce=G;const he=Ce.getInstance(),pt=class extends xe{compositionStartHandler(s){super.compositionStartHandler(s)}compositionEndHandler(s){super.compositionEndHandler(s);const e=s.data;e&&this.editor.insertTextAtCursor(e)}beforeInputHandler_(s){const e=s.inputType;if(e==="insertCompositionText"||e==="deleteCompositionText")return;s.preventDefault();let t=null;switch(e){case"deleteContentBackward":this.editor.deleteTextAtCursor();break;case"deleteContentForward":break;case"insertParagraph":this.editor.insertTextAtCursor(`
`);break;case"insertText":t=s.data,t&&this.editor.insertTextAtCursor(t);break;case"insertFromPaste":t=s.dataTransfer.getData("text/plain"),t&&this.editor.insertTextAtCursor(t)}}keydownHandler_(s){return he.isTab(s)&&(s.preventDefault(),this.editor.insertTextAtCursor("	")),he.isRedo(s)?(s.preventDefault(),void(this.editor.redo&&typeof this.editor.redo=="function"&&this.editor.redo())):he.isUndo(s)?(s.preventDefault(),void(this.editor.undo&&typeof this.editor.undo=="function"&&this.editor.undo())):he.isChangeMode(s)?(s.preventDefault(),void this.editor.switchViewMode()):void 0}addListeners(){const s=this.beforeInputHandler_.bind(this),e=this.keydownHandler_.bind(this),t=this.compositionStartHandler.bind(this),n=this.compositionEndHandler.bind(this);this.target.addEventListener("beforeinput",s),this.target.addEventListener("keydown",e),this.target.addEventListener("compositionstart",t),this.target.addEventListener("compositionend",n),this.cacheEventHandler({type:"beforeinput",listener:s}),this.cacheEventHandler({type:"keydown",listener:e}),this.cacheEventHandler({type:"compositionstart",listener:t}),this.cacheEventHandler({type:"compositionend",listener:n})}},ft=class extends xe{mousedownHandler_(s){}mousemoveHandler_(s){}mouseupHandler_(s){}addListeners(){const s=this.mousedownHandler_.bind(this),e=this.mousemoveHandler_.bind(this),t=this.mouseupHandler_.bind(this);this.target.addEventListener("mousedown",s),this.target.addEventListener("mousemove",e),this.target.addEventListener("mouseup",t),this.cacheEventHandler({type:"mousedown",listener:s}),this.cacheEventHandler({type:"mousemove",listener:e}),this.cacheEventHandler({type:"mouseup",listener:t})}},_t=class extends xe{constructor(){super(...arguments);r(this,"selectionchangeHandlerBinder_")}selectionchangeHandler_(e){this.getComposing()||(e?this.editor.setSelection(e.anchor,e.focus):this.editor.removeSelection())}addListeners(){super.addListeners(),this.selectionchangeHandlerBinder_=this.selectionchangeHandler_.bind(this),this.view.on(re.EVENT_TYPE.SELECTION_CHANGE,this.selectionchangeHandlerBinder_)}dispose(){super.dispose(),this.view.off(re.EVENT_TYPE.SELECTION_CHANGE,this.selectionchangeHandlerBinder_)}},mt=z;class gt{constructor(e,t={}){r(this,"markdownStringCompleter_",new Te().build());r(this,"style_");r(this,"elementContainer_");r(this,"element_");r(this,"config_");r(this,"textModel_");r(this,"selectionModel_");r(this,"viewProvider_");r(this,"view_");r(this,"eventHandler_");this.elementContainer_=e,this.config_={mode:z.RENDER,placeholder:"",...t},this.initElement_(),this.textModel_=new h,this.selectionModel_=new d(this.textModel_),this.viewProvider_=new dt,this.initView_()}initElement_(){const e=document.createElement("pre");e.setAttribute("placeholder",this.config_.placeholder),e.setAttribute("contenteditable","true"),e.setAttribute("spellcheck","false"),e.setAttribute("class","web-editor-pre"),this.elementContainer_.appendChild(e),this.element_=e}initView_(){this.view_=this.viewProvider_.provide(this.config_.mode,this.textModel_,this.selectionModel_,this.element_),this.eventHandler_=new class{constructor(e,t){r(this,"keyboardEventHandler_");r(this,"mouseEventHandler_");r(this,"viewEventHandler_");this.keyboardEventHandler_=new pt(e,t),this.mouseEventHandler_=new ft(e,t),this.viewEventHandler_=new _t(e,t)}addListeners(){this.keyboardEventHandler_.addListeners(),this.mouseEventHandler_.addListeners(),this.viewEventHandler_.addListeners()}dispose(){this.keyboardEventHandler_.dispose(),this.mouseEventHandler_.dispose(),this.viewEventHandler_.dispose()}}(this,this.view_),this.eventHandler_.addListeners(),this.view_.render()}getTextModel(){return this.textModel_}getSelectionModel(){return this.selectionModel_}getElement(){return this.element_}focus(){this.element_.focus()}blur(){this.element_.blur()}apply(e){e.apply(this),this.focus()}insertTextAtCursor(e){const t=this.beforeInsert(e);if(!(e=t.input).length)return;const n=this.selectionModel_.getSelection();let i=n.anchor;if(this.selectionModel_.isCollapsed()||(this.apply(new E(n.anchor,n.focus)),this.selectionModel_.isBackward()&&(i=n.focus)),t.needDelete&&t.needDelete.length){let o=i-this.textModel_.getLineByIndex(i).length,a=o+t.needDelete[0],c=o+t.needDelete[1];this.apply(new E(a,c)),i-=c-a}else{const o=t.cursorDelta===void 0?e.length:t.cursorDelta;this.apply(new x(e,i)),i+=o}this.setSelection(i)}insertText(e,t){const n=this.selectionModel_.getSelection();this.apply(new x(t,e)),n.anchor<=e?this.setSelection(n.anchor):this.setSelection(n.anchor+t.length)}deleteTextAtCursor(){let e=this.selectionModel_.getSelection(),t=e.anchor;if(this.selectionModel_.isCollapsed()){if(e.anchor>0){const n=this.beforeDelete(),i=n.deleteLen;if(i===0)return;n.cursorDelta!==void 0&&n.cursorDelta>0&&(t+=n.cursorDelta,this.setSelection(t));const o=t-i;this.apply(new E(o,t)),t=o}}else this.apply(new E(e.anchor,e.focus)),this.selectionModel_.isBackward()&&(t=e.focus);this.setSelection(t)}deleteText(e,t){const n=this.selectionModel_.getSelection();this.apply(new E(e,e+t)),n.anchor<=e?this.setSelection(n.anchor):e+t<n.anchor?this.setSelection(n.anchor-t):this.setSelection(e)}setSelection(e,t){this.apply(new Y({anchor:e,focus:t||t===0?t:e}))}removeSelection(){this.apply(new Y(null))}moveBackward(){this.selectionModel_.getSelection(),this.selectionModel_.isCollapsed()}moveForward(){this.selectionModel_.getSelection(),this.selectionModel_.isCollapsed()}switchViewMode(e){if(e===this.config_.mode)return;let t=e;t||(t=this.config_.mode===z.RENDER?z.SOURCE:z.RENDER),this.eventHandler_.dispose(),this.view_.dispose(),this.config_.mode=t,this.initView_(),this.focus()}beforeInsert(e){let t,n=[],i=e;if(e===`
`){const o=this.view_.inDom("table");if(o){const a=o.sourceIndex,c=this.textModel_.getLength();e=a[1]===c?`

`:`
`,this.insertText(a[1],e),this.setSelection(a[1]+2),e=""}else{const a=this.selectionModel_.getSelection();let c=this.textModel_.getLineByIndex(a.anchor);for(;;){let g=te(c),N=g.length;N&&(c=c.slice(N));const O=this.markdownStringCompleter_.complete({line:c});if(!O)break;if(O.needDeleteTab){n=N?[0,1]:[0,c.length];break}if(c=O.lineRest,e+=g+O.completeInput,O.cursor!==void 0){if(this.config_.mode!==z.RENDER)return{input:i};t=O.cursor+1}}}}else if(this.config_.mode===z.RENDER&&e==="	"){const o=this.selectionModel_.getSelection();let a=this.textModel_.getLineByIndex(o.anchor);const c=a.match(/^(\s*[*+-]\s+)+/)||a.match(/^(\s*(\d{1,9})([.)])\s+)+/);c&&c[0].length===a.length&&(this.insertText(o.anchor-a.length,"	"),e="")}else this.config_.mode===z.SOURCE&&e==="|"&&this.view_.inDom("table")&&this.view_.inDom("table")&&(e="\\|");return{input:e,cursorDelta:t,needDelete:n}}beforeDelete(){if(this.config_.mode!==z.RENDER)return{deleteLen:1};const e=this.selectionModel_.getSelection(),t=this.view_.inDom("td")||this.view_.inDom("th");if(t&&t.sourceIndex[0]===e.anchor)return{deleteLen:0};let n,i=this.textModel_.getLineByIndex(e.anchor),o=1;for(;;){let a=te(i).length;if(a&&(i=i.slice(a),i.length===0)){o+=a;break}const c=this.markdownStringCompleter_.delete({line:i});if(!c)break;i=c.lineRest,o=c.deleteLen,c.cursor!==void 0&&c.cursor>0&&(n=c.cursor)}return{deleteLen:i.length?1:o,cursorDelta:n}}getContent(){return this.textModel_.getSpacer()}setContent(e){this.textModel_.setContent(e),this.setSelection(0)}clearContent(){this.textModel_.clear(),this.setSelection(0)}dispose(){this.eventHandler_.dispose(),this.view_.dispose(),this.element_.remove(),this.style_.remove()}}const bt=s=>{const e=s,t=s.apply.bind(s);return e.apply=n=>{t(n)},e},vt=s=>{const e=s,t=s.apply.bind(s),n=s.clearContent.bind(s),i=s.setContent.bind(s);return e.history={undos:[],redos:[]},e.operations=[],e.redo=()=>{const{history:o}=e,{redos:a}=o;if(a.length>0){const c=a.pop();for(const g of c)t(g);o.undos.push(c)}},e.undo=()=>{const{history:o}=e,{undos:a}=o;if(a.length>0){const c=a.pop(),g=c.map(N=>N.inverse()).reverse();for(const N of g)t(N);o.redos.push(c)}},e.apply=o=>{const{operations:a,history:c}=e;t(o),a.push(o),Ct(a,c)},e.clearContent=()=>{const{history:o}=e;n(),setTimeout(()=>{o.undos=[],o.redos=[]},300)},e.setContent=o=>{const{history:a}=e;i(o),setTimeout(()=>{a.undos=[],a.redos=[]},300)},e},xt=s=>s instanceof x,Ct=l((s,e)=>{const{undos:t}=e;let n=t[t.length-1],i=n&&n[n.length-1],o=!1;for(let a of s){let c=!1;a instanceof Y&&i&&i instanceof Y&&(a=Y.merge(i,a),c=!0),o||c?(c&&n.pop(),n.push(a)):(n=[a],t.push(n),o=!0),i=a,xt(a)&&(e.redos=[])}for(;t.length>100;)t.shift();s.length=0},300)})(),se})()})})(Ee);var Le=Ee.exports;const Et=yt(Le),It=St({__proto__:null,default:Et},[Le]);export{It as i};
